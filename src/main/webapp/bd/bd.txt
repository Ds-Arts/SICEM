CREATE DATABASE elementos1;
USE elementos1;
CREATE TABLE Categoria (
nombreCategoria VARCHAR(50) PRIMARY KEY,
DescripcionCategoria VARCHAR(300)
);
CREATE TABLE rol (
nombreRol VARCHAR(50) PRIMARY KEY
);

CREATE TABLE Elementos (
NombreElemento VARCHAR(50),
N_placa INT PRIMARY KEY ,
cantidad INT,
Costo INT,
TipoElemento VARCHAR(50),
FechaIngresoElemento DATE,
categoriaElemento VARCHAR(30),
NumAula INT,
Descripcion VARCHAR(300),
EstadoElemento VARCHAR(20),
usuario_fk int
);

CREATE TABLE usuarios (
id INT PRIMARY KEY AUTO_INCREMENT,
nombre VARCHAR(100),
apellido VARCHAR(50),
email VARCHAR(225),
numIdentificacion INT,
contrasena VARCHAR(50),
rol_fk VARCHAR(50),
activo VARCHAR(50),
FOREIGN KEY (rol_fk) REFERENCES rol (nombreRol)
);

CREATE TABLE propiedad (
cuentadante_fk INT,
prestatario_fk INT,
elemento_fk INT,
fecha_transpaso DATE,
tipo BOOLEAN,
fecha_inicio DATE,
fecha_fin DATE,

PRIMARY KEY (cuentadante_fk, elemento_fk,prestatario_fk),
FOREIGN KEY (cuentadante_fk) REFERENCES usuarios (id),
FOREIGN KEY (prestatario_fk) REFERENCES usuarios (id),
FOREIGN KEY (elemento_fk) REFERENCES Elementos (N_placa)
);

alter table elementos
add constraint uFk FOREIGN KEY (usuario_fk)
REFERENCES usuarios (id);

ALTER TABLE Elementos
ADD CONSTRAINT fkcategoria FOREIGN KEY (categoriaElemento)
REFERENCES Categoria (nombreCategoria);

DELIMITER //
CREATE PROCEDURE InsertarCategoria(IN nombreCat VARCHAR(50), IN descripcionCat VARCHAR(300))
BEGIN
INSERT INTO Categoria(nombreCategoria, DescripcionCategoria)
VALUES(nombreCat, descripcionCat);
END;
//
DELIMITER ;

DELIMITER //
CREATE PROCEDURE InsertarUsuario(
IN nombreUsuario VARCHAR(100),
IN apellidoUsuario VARCHAR(50),
IN emailUsuario VARCHAR(225),
IN numIdentificacionUsuario INT,
IN contrasenaUsuario VARCHAR(50),
IN rolUsuario VARCHAR(50),
IN activoUsuario VARCHAR(50)
)
BEGIN
INSERT INTO usuarios(nombre, apellido, email, numIdentificacion, contrasena, rol_fk, activo)
VALUES(nombreUsuario, apellidoUsuario, emailUsuario, numIdentificacionUsuario, contrasenaUsuario, rolUsuario, activoUsuario);
END;
//
DELIMITER ;

DELIMITER //
CREATE PROCEDURE InsertarElemento(
IN nombreElemento VARCHAR(50),
IN nPlaca INT,
IN cantidad INT,
IN costo INT,
IN tipoElemento VARCHAR(50),
IN fechaIngreso DATE,
IN categoriaElemento VARCHAR(50),
IN numAula INT,
IN descripcion VARCHAR(300),
IN estadoElemento VARCHAR(20),
IN usuarioElemento int
)
BEGIN
INSERT INTO Elementos(NombreElemento, N_placa, cantidad, Costo, TipoElemento, FechaIngresoElemento, categoriaElemento, NumAula, Descripcion, EstadoElemento,usuario_fk)
VALUES(nombreElemento, nPlaca, cantidad, costo, tipoElemento, fechaIngreso, categoriaElemento, numAula, descripcion, estadoElemento,usuarioElemento);
END;
//
DELIMITER ;

DELIMITER //
CREATE PROCEDURE InsertarRol(
IN nombreRol VARCHAR(50)
)
BEGIN
INSERT INTO Rol(nombreRol)
VALUES(nombreRol);
END;
//
DELIMITER ;
call elementos1.InsertarRol('Cuentadante');
call elementos1.InsertarRol('Instructor');
call elementos1.InsertarRol('Administrador');